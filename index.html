<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <title>VClimb</title>
<style>
 body {
  font-family: 'Orbitron', sans-serif;
  background: #404D58;
  color: #ffc000;
  padding: 20px;
  margin: 0;
  max-width: 100%;
  box-sizing: border-box;
}

input, select, button {
  width: 100%;
  font-size: 1rem;
  padding: 10px;
  box-sizing: border-box;
}

  h1, h2, h3 {
    color: #ffc000;
  }

  .section {
    background: #556573;
    padding: 20px;
    margin-bottom: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }

  label {
    display: block;
    margin-top: 10px;
    font-weight: bold;
  }

  input, select, button {
    margin-top: 5px;
    padding: 8px;
    width: 100%;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 1em;
  }

  button {
    background-color: #bf0000;
    color: white;
    border: none;
    cursor: pointer;
    transition: background 0.3s ease;
  }

  button:hover {
    background-color: #f30808;
  }

  #scoreboard ul, #leaderboard ul {
    list-style: none;
    padding-left: 0;
  }

  li {
    padding: 5px 0;
    border-bottom: 1px solid #eee;
  }

  strong {
    display: block;
    margin-top: 10px;
    font-size: 1.2em;
  }
  .gameplay-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 20px;
}
@media (max-width: 600px) {
  .gameplay-row {
    flex-direction: column;
    align-items: stretch;
    gap: 10px;
  }

  #bigScore {
    font-size: 2.5em;
    margin-top: 10px;
  }

  button {
    font-size: 1.1em;
    padding: 12px;
  }
}
input[type="text"], input[type="number"], select {
  background-color: #404D58;   /* light blue background */
  color: #ffc000;              /* dark text */
  border: 1px solid #bf0000;   /* accent border */
  border-radius: 5px;
  padding: 10px;
  font-size: 1em;
}
/* Ensure color stays the same when focused */
input[type="text"]:focus {
  color: #ffc000;
  background-color: #556573;
  outline: none;
  border-color: #bf0000;
}
.app-title {
  text-align: center;
  font-size: 2.5em;
  color: #ffc000;
  margin-bottom: 20px;
  font-weight: 700;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
  letter-spacing: 1px;
  border-bottom: 2px solid #ffc000;
  padding-bottom: 10px;
}
.player-name {
  color: #ffc000; /* golden yellow or your chosen highlight */
  font-weight: bold;
}

.player-score {
  color: #ffc000; /* light blue or any accent color */
  font-weight: 600;
}
.player-info {
  background-color: #404D58; /* dark panel background */
  padding: 10px;
  border-radius: 8px;
  margin-bottom: 10px;
  color: #404D58;
  display: inline-block;
  width: 100%;
  box-sizing: border-box;
}
.player-info {
  background-color: #556573; /* your dark slate */
  padding: 10px;
  border-radius: 8px;
  margin-bottom: 10px;
  color: #ffc000;
  border: 1px solid #bf0000;
  box-sizing: border-box;
}

.player-info.current {
  background-color: #404D58; /* highlight for current player */
  box-shadow: 0 0 10px rgba(255, 192, 0, 0.3);
}

.player-info.warning {
  color: red;
}
.timer-display {
  font-size: 3em;           /* Bigger text */
  font-weight: bold;
  color: #ffc000;           /* Golden yellow */
  text-align: center;
  margin: 20px auto;
}
@keyframes flashRed {
  0% { color: red; }
  50% { color: #ff6666; }
  100% { color: red; }
}

.timer-flash {
  animation: flashRed 1s infinite;
}
</style>
</head>
<body>

  <h1 class="app-title">VClimb</h1>

  <div class="section" id="setup">
   <div id="playerSetup">
  <label>Add Player:
    <input type="text" id="newPlayerName">
  </label>
  <button onclick="addPlayer()">Add Player</button>
  <ul id="playerList"></ul>
</div>
    <label>Game Mode:
      <select id="gameMode">
        <option value="unlimited">Unlimited</option>
        <option value="time">Time Mode</option>
        <option value="limit">Climb Limit Mode</option>
      </select>
    </label>
   <label id="customInputLabel" style="display:none;">
  Select Time Limit:
  <select id="customValue">
    <option value="1">1 minute</option>
    <option value="5">5 minutes</option>
    <option value="10">10 minutes</option>
    <option value="15">15 minutes</option>
    <option value="20">20 minutes</option>
    <option value="30">30 minutes</option>
    <option value="45">45 minutes</option>
    <option value="60">60 minutes</option>
  </select>
</label>
    <button onclick="startGame()">Start Game</button>
  </div>

  <div class="section" id="gameplay" style="display:none;">
    <h2 id="currentGrade">Current Grade: V0</h2>
    <div class="gameplay-row">
  <!-- gameplay controls and score -->
</div>
  <div style="flex: 1;">
    <label>Climb Completed:</label>
<div style="display: flex; gap: 10px;">
  <button onclick="completeClimb(1)">1 Attempt</button>
  <button onclick="completeClimb(2)">2 Attempts</button>
  <button onclick="completeClimb(3)">3 Attempts</button>
</div>
    <div id="playerScores" style="margin-bottom: 20px;"></div>
    <button onclick="failClimb()">Climb Failed</button>
  </div><button onclick="endGame('Game ended manually.')">End Game</button>
  <div style="flex-shrink: 0; text-align: center;">
    <h2 style="font-size: 2.5em; margin: 0; color: #2e8b57;">Score</h2>
    <div id="bigScore" style="font-size: 3em; font-weight: bold; color: #333;">0</div>
  </div>
</div>
<div id="timerDisplay" class="timer-display" style="display:none;">
  Time Left: <span id="timerText">00:00</span>
</div>
</div>
<div id="scoreboard" style="display:none;">
  <h3>Score Summary</h3>
  <ul id="scoreList"></ul>
  <strong>Total Score: <span id="totalScore">0</span></strong>
</div>

 <script>
  let players = [];
  let currentPlayerIndex = 0;
  let gameMode = 'unlimited';
  let customLimit = 0;
  let timerInterval = null;
  let timeRemaining = 0;

  function addPlayer() {
    const nameInput = document.getElementById('newPlayerName');
    const name = nameInput.value.trim();
    if (name) {
      players.push({ name, score: 0, history: [], v0Climbs: 0, grade: 0 });
      nameInput.value = '';
      updatePlayerList();
      
    }
  }

  function nextPlayer() {
  if (players.length === 0) return;

  currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
  updateGradeDisplay();
  updatePlayerDisplay();
  document.getElementById('bigScore').innerText = players[currentPlayerIndex].score;
  updatePlayerScores();
}

  function updatePlayerList() {
    const list = document.getElementById('playerList');
    list.innerHTML = '';
    players.forEach((player, index) => {
      const item = document.createElement('li');
      item.textContent = `${index + 1}. ${player.name}`;
      list.appendChild(item);
    });
  }

  function updatePlayerDisplay() {
    const player = players[currentPlayerIndex];
    document.getElementById('currentGrade').innerText = `Current Grade: V${player.grade} | Player: ${player.name}`;
  }

  document.getElementById('gameMode').addEventListener('change', function () {
    const mode = this.value;
    document.getElementById('customInputLabel').style.display = (mode !== 'unlimited') ? 'block' : 'none';
  });
function startGame() {
  // Auto-add default player if none exist
  if (players.length === 0) {
    players.push({ name: "Mystery Climber", score: 0, history: [], v0Climbs: 0, grade: 0 });
    updatePlayerList();
  }

  const mode = document.getElementById('gameMode').value;
  const custom = parseInt(document.getElementById('customValue').value);
  gameMode = mode;
  customLimit = isNaN(custom) ? 0 : custom;

  document.getElementById('setup').style.display = 'none';
  document.getElementById('gameplay').style.display = 'block';
  updateGradeDisplay();

  if (gameMode === 'time') {
    timeRemaining = customLimit * 60;
    document.getElementById('timerDisplay').style.display = 'block';
    updateTimerDisplay();
    startTimer();
  } else {
    document.getElementById('timerDisplay').style.display = 'none';
  }

  updatePlayerScores();
}
function updateTimerDisplay(secondsRemaining) {
  const timerText = document.getElementById('timerText');
  timerText.textContent = formatTime(secondsRemaining);

  if (secondsRemaining <= 10) {
    timerText.style.color = 'red';
  } else {
    timerText.style.color = '#ffc000';
  }
}
  function updateGradeDisplay() {
    const player = players[currentPlayerIndex];
    document.getElementById('currentGrade').innerText = `Current Grade: V${player.grade}`;
  }

  function calculatePoints(grade, attempts) {
    if (grade === 0) return 0;
    if (grade === 1) return 1;
    if (grade === 2) return attempts <= 2 ? 2 : 1;
    if (grade >= 3) {
      if (attempts === 1) return 3;
      if (attempts === 2) return 2;
      return 1;
    }
    return 0;
  }

function completeClimb(attempts) {
  const player = players[currentPlayerIndex];
if (!player) {
  console.error('No current player found');
  return;
}
  const points = calculatePoints(player.grade, attempts);

  // Count V0 climbs in limit mode
if (gameMode === 'limit' && player.grade === 0) {
  if (player.v0Climbs + 1 > customLimit) {
    endGame(`${player.name} reached the V0 climb limit.`);
    return;
  }
  player.v0Climbs++;
}

  player.history.push({ grade: player.grade, attempts, points });
  player.score += points;
  player.grade++;

  document.getElementById('bigScore').innerText = player.score;
  updatePlayerScores();
  updateGradeDisplay();
  updatePlayerDisplay();

  nextPlayer();

console.log(`Player: ${player.name}, Grade: V${player.grade}`);
}

function failClimb() {
  const player = players[currentPlayerIndex];
if (!player) {
  console.error('No current player found');
  return;
}

  // Count V0 climbs in limit mode
if (gameMode === 'limit' && player.grade === 0) {
  if (player.v0Climbs + 1 > customLimit) {
    endGame(`${player.name} reached the V0 climb limit.`);
    return;
  }
  player.v0Climbs++;
}

  player.history.push({ grade: player.grade, attempts: 3, points: 0 });
  player.grade = 0;

  document.getElementById('bigScore').innerText = player.score;
  updatePlayerScores();
  updateGradeDisplay();
  updatePlayerDisplay();

  nextPlayer();
 
console.log(`Player: ${player.name}, Grade: V${player.grade}`);
}

let TimeRemaining = 120; // 2 minutes in seconds

function startTimer() {
  const interval = setInterval(() => {
    updateTimerDisplay(timeRemaining);
    timeRemaining--;

    if (timeRemaining < 0) {
      clearInterval(interval);
      // handle end of timer
    }
  }, 1000);
}

function formatTime(seconds) {
  if (isNaN(seconds) || seconds < 0) return '00:00';
  const mins = Math.floor(seconds / 60);
  const secs = seconds % 60;
  return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
}

 function endGame(message) {
  if (gameMode === 'unlimited') {
    if (!confirm("DONT BE SO WEAK! Are you sure you want to end the game?")) return;
  }

  clearInterval(timerInterval);
  document.getElementById('scoreboard').style.display = 'block';
  document.getElementById('leaderboard').style.display = 'block';
  document.getElementById('climbHistoryPage').style.display = 'block';
  document.getElementById('finalLeaderboard').style.display = 'block';

  updateLeaderboard();
  updateClimbHistory();
  renderFinalLeaderboard();
  alert(`${message}`);
}

  function updateLeaderboard() {
    const list = document.getElementById('leaderboardList');
    list.innerHTML = '';
    players.sort((a, b) => b.score - a.score);
    players.forEach((player, index) => {
      const item = document.createElement('li');
      item.textContent = `${index + 1}. ${player.name} - ${player.score} points`;
      list.appendChild(item);
    });
  }

  function updateClimbHistory() {
    const list = document.getElementById('climbHistoryList');
    list.innerHTML = '';
    players.forEach((player) => {
      const header = document.createElement('li');
      header.innerHTML = `<strong>${player.name}</strong>`;
      list.appendChild(header);
      player.history.forEach((entry, index) => {
        const item = document.createElement('li');
        item.textContent = `#${index + 1}: V${entry.grade} | Attempts: ${entry.attempts} | Points: ${entry.points}`;
        list.appendChild(item);
      });
    });
  }

  function updatePlayerScores() {
  const container = document.getElementById('playerScores');
  container.innerHTML = '';

  players.forEach((player, index) => {
    const div = document.createElement('div');
    const isCurrent = index === currentPlayerIndex;

    // Calculate remaining V0 climbs
    const remaining = customLimit - player.v0Climbs;
    const warning = gameMode === 'limit' && remaining === 1;

  div.className = 'player-info';
if (isCurrent) div.classList.add('current');
if (warning) div.classList.add('warning');

    let countdownText = '';
    if (gameMode === 'limit') {
      countdownText = ` | V0 climbs left: ${remaining}`;
    }

div.innerHTML = `
  <span class="player-name">${player.name}</span>: 
  <span class="player-score">${player.score} points</span>
  ${countdownText}
`;
    container.appendChild(div);
  });
}

  function renderFinalLeaderboard() {
    const body = document.getElementById('leaderboardBody');
    body.innerHTML = '';

    players.forEach(player => {
      let total = 0;
      player.history.forEach((entry, index) => {
        total += entry.points;
        const row = document.createElement('tr');
        row.innerHTML = `
          <td style="padding:8px; border:1px solid #ccc;">${player.name}</td>
          <td style="padding:8px; border:1px solid #ccc;">${index + 1}</td>
          <td style="padding:8px; border:1px solid #ccc;">V${entry.grade}</td>
          <td style="padding:8px; border:1px solid #ccc;">${entry.attempts}</td>
          <td style="padding:8px; border:1px solid #ccc;">${entry.points}</td>
          <td style="padding:8px; border:1px solid #ccc;">${total}</td>
        `;
        body.appendChild(row);
      });
    });
  }
</script>

<!-- Final Leaderboard Table -->
<div class="section" id="finalLeaderboard" style="display:none;">
  <h2>Final Leaderboard</h2>
  <table id="leaderboardTable" style="width:100%; border-collapse: collapse;">
    <thead>
      <tr style="background-color:#404D58; color:#ffc000;">
        <th style="padding:8px; border:1px solid #ccc;">Player</th>
        <th style="padding:8px; border:1px solid #ccc;">Climb #</th>
        <th style="padding:8px; border:1px solid #ccc;">Grade</th>
        <th style="padding:8px; border:1px solid #ccc;">Attempts</th>
        <th style="padding:8px; border:1px solid #ccc;">Points</th>
        <th style="padding:8px; border:1px solid #ccc;">Total</th>
      </tr>
    </thead>
    <tbody id="leaderboardBody"></tbody>
  </table>
</div>

<!-- Leaderboard Section -->
<div class="section" id="leaderboard" style="display:none;">
  <h2>Leaderboard</h2>
  <ul id="leaderboardList"></ul>
  <button onclick="exportCSV()">Export as CSV</button>
  <button onclick="exportJSON()">Export as JSON</button>
</div>

<!-- Climb History Section -->
<div class="section" id="climbHistoryPage" style="display:none;">
  <h2>Climb History</h2>
  <ul id="climbHistoryList"></ul>
</div>

</body>
</html>